<!DOCTYPE html>
<html>
<head>
    <title>Test Contact Sync - Motor Sale</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 12px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .current-data { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; }
        pre { background: #f1f1f1; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Test Contact Synchronization</h1>
        
        <div class="card">
            <h3>Datos Actuales en localStorage</h3>
            <button onclick="loadCurrentData()">Cargar Datos Actuales</button>
            <div id="currentData" class="current-data"></div>
        </div>
        
        <div class="card">
            <h3>Simular Cambios del Admin</h3>
            <form id="contactForm">
                <div class="form-group">
                    <label for="phone">Tel√©fono:</label>
                    <input type="text" id="phone" value="+56 9 7758 7288" placeholder="+56 9 7758 7288">
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" value="MOTORSALE.CL@GMAIL.COM" placeholder="MOTORSALE.CL@GMAIL.COM">
                </div>
                
                <div class="form-group">
                    <label for="address">Direcci√≥n:</label>
                    <input type="text" id="address" value="camino el arpa 825 lote 127, buin" placeholder="camino el arpa 825 lote 127, buin">
                </div>
                
                <button type="button" onclick="updateContactInfo()">Actualizar Informaci√≥n</button>
                <button type="button" onclick="clearAllData()">Limpiar Todo</button>
            </form>
            <div id="updateStatus"></div>
        </div>
        
        <div class="card">
            <h3>Verificar Sincronizaci√≥n</h3>
            <button onclick="checkSync()">Verificar si los Cambios se Aplicaron</button>
            <div id="syncStatus"></div>
        </div>
        
        <div class="card">
            <h3>Acciones R√°pidas</h3>
            <button onclick="openMainSite()">Abrir P√°gina Principal</button>
            <button onclick="openAdmin()">Abrir Admin</button>
        </div>
    </div>

    <script>
        function loadCurrentData() {
            const contact = localStorage.getItem('motorsale_contact_info');
            const vehicles = localStorage.getItem('motorsale_vehicles');
            
            let html = '<h4>Informaci√≥n de Contacto:</h4>';
            if (contact) {
                const data = JSON.parse(contact);
                html += `
                    <p><strong>Tel√©fono:</strong> ${data.phone}</p>
                    <p><strong>WhatsApp:</strong> ${data.whatsapp}</p>
                    <p><strong>Email:</strong> ${data.email}</p>
                    <p><strong>Direcci√≥n:</strong> ${data.address}</p>
                    <p><strong>Ciudad:</strong> ${data.city}</p>
                    <p><strong>√öltima actualizaci√≥n:</strong> ${new Date(data.updatedAt).toLocaleString()}</p>
                `;
            } else {
                html += '<p class="error">No hay datos de contacto guardados</p>';
            }
            
            html += '<h4>Veh√≠culos:</h4>';
            if (vehicles) {
                const vehicleData = JSON.parse(vehicles);
                html += `<p>${vehicleData.length} veh√≠culos encontrados</p>`;
            } else {
                html += '<p class="error">No hay veh√≠culos guardados</p>';
            }
            
            document.getElementById('currentData').innerHTML = html;
        }
        
        function updateContactInfo() {
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value.toLowerCase();
            const address = document.getElementById('address').value;
            
            // Crear objeto de contacto actualizado
            const updatedContact = {
                phone: phone,
                email: email,
                whatsapp: phone, // Usar el mismo n√∫mero para WhatsApp
                address: address,
                city: 'Buin',
                region: 'Regi√≥n Metropolitana',
                country: 'Chile',
                businessHours: {
                    monday: { open: '09:00', close: '18:00' },
                    tuesday: { open: '09:00', close: '18:00' },
                    wednesday: { open: '09:00', close: '18:00' },
                    thursday: { open: '09:00', close: '18:00' },
                    friday: { open: '09:00', close: '18:00' },
                    saturday: { open: '09:00', close: '14:00' },
                    sunday: { open: '10:00', close: '14:00', closed: true }
                },
                socialMedia: {
                    facebook: 'https://facebook.com/motorsale',
                    instagram: 'https://instagram.com/motorsale'
                },
                companyName: 'Motor Sale',
                companyDescription: 'Tu concesionaria de confianza en Buin.',
                metaTitle: 'Motor Sale - Compra y Venta de Veh√≠culos en Buin',
                metaDescription: 'Encuentra el auto perfecto en Motor Sale.',
                updatedAt: new Date().toISOString()
            };
            
            // Guardar en localStorage
            localStorage.setItem('motorsale_contact_info', JSON.stringify(updatedContact));
            
            // Disparar evento personalizado para simular EventBus
            window.dispatchEvent(new CustomEvent('contactInfoUpdated', {
                detail: updatedContact
            }));
            
            // Disparar evento storage para componentes que escuchan cambios
            window.dispatchEvent(new StorageEvent('storage', {
                key: 'motorsale_contact_info',
                newValue: JSON.stringify(updatedContact),
                storageArea: localStorage
            }));
            
            document.getElementById('updateStatus').innerHTML = `
                <p class="success">‚úÖ Informaci√≥n actualizada correctamente:</p>
                <ul>
                    <li><strong>Tel√©fono:</strong> ${phone}</li>
                    <li><strong>Email:</strong> ${email}</li>
                    <li><strong>Direcci√≥n:</strong> ${address}</li>
                </ul>
            `;
            
            // Recargar datos actuales
            loadCurrentData();
        }
        
        function clearAllData() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los datos?')) {
                localStorage.clear();
                sessionStorage.clear();
                document.getElementById('updateStatus').innerHTML = '<p class="success">‚úÖ Todos los datos han sido eliminados</p>';
                loadCurrentData();
            }
        }
        
        function checkSync() {
            const contact = localStorage.getItem('motorsale_contact_info');
            if (contact) {
                const data = JSON.parse(contact);
                const expectedPhone = '+56 9 7758 7288';
                const expectedEmail = 'motorsale.cl@gmail.com';
                const expectedAddress = 'camino el arpa 825 lote 127, buin';
                
                let html = '<h4>Estado de Sincronizaci√≥n:</h4>';
                
                if (data.phone === expectedPhone) {
                    html += '<p class="success">‚úÖ Tel√©fono sincronizado correctamente</p>';
                } else {
                    html += `<p class="error">‚ùå Tel√©fono no sincronizado. Actual: ${data.phone}, Esperado: ${expectedPhone}</p>`;
                }
                
                if (data.email === expectedEmail) {
                    html += '<p class="success">‚úÖ Email sincronizado correctamente</p>';
                } else {
                    html += `<p class="error">‚ùå Email no sincronizado. Actual: ${data.email}, Esperado: ${expectedEmail}</p>`;
                }
                
                if (data.address === expectedAddress) {
                    html += '<p class="success">‚úÖ Direcci√≥n sincronizada correctamente</p>';
                } else {
                    html += `<p class="error">‚ùå Direcci√≥n no sincronizada. Actual: ${data.address}, Esperado: ${expectedAddress}</p>`;
                }
                
                document.getElementById('syncStatus').innerHTML = html;
            } else {
                document.getElementById('syncStatus').innerHTML = '<p class="error">‚ùå No hay datos para verificar</p>';
            }
        }
        
        function openMainSite() {
            window.open('http://localhost:5176/', '_blank');
        }
        
        function openAdmin() {
            window.open('http://localhost:5176/admin', '_blank');
        }
        
        // Cargar datos al iniciar
        window.onload = function() {
            loadCurrentData();
        }
        
        // Escuchar cambios en localStorage
        window.addEventListener('storage', function(e) {
            if (e.key === 'motorsale_contact_info') {
                console.log('Detectado cambio en contacto:', e.newValue);
                loadCurrentData();
            }
        });
    </script>
</body>
</html>
